<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bunny Home - Level 01 (Fixed)</title>
  <link rel='icon' href='https://i.pinimg.com/736x/bf/80/4a/bf804a1e545c28d7df21f04b1755712d.jpg' />
  <style>
    /* === Your original CSS === */
    body {
      margin: 0;
      background-size: cover;
    }
    .splash-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background-color: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 7;
    }
    .splash-screen img {
      width: 80%;
      height: 80%;
      object-fit: contain;
    }
    #sidebar {
      position: fixed;
      top: 20%;
      right: 20px;
      display: flex;
      flex-direction: column;
    }
    .circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: #000;
      margin-bottom: 20px;
    }
    .surface {
      position: absolute;
      background-color: #ffdd00;
      width: 20px;
      height: 2px;
      border-bottom: 2px solid #ffc400;
    }
    .obstacle {
      position: absolute;
      background-color: #d5d5d5;
      width: 150px;
      height: 15px;
      border: 2px solid #5f5f5f;
    }
    .palace {
      position: absolute;
      background-color: #deb316;
      width: 245px;
      height: 15px;
      border: 2px solid #ffb73a;
    }
    .door {
      position: absolute;
      width: 100px;
      height: 80px;
      background-image: url('https://img.freepik.com/free-vector/blank-banner-garden-with-cute-rabbits-isolated_1308-57388.jpg?semt=ais_hybrid');
      background-size: contain;
      background-repeat: no-repeat;
    }
    #gameCanvas {
      border: 4px solid #FF69B4;
    }
    #game-container {
      position: relative;
      width: 1530px;
      height: 610px;
      border: none;
    }
    #player {
      background: url('https://cdna.artstation.com/p/assets/images/images/038/795/764/original/bijou-buni-bunnydance-1.gif?1624079882') no-repeat;
      background-size: cover;
      width: 100px;
      height: 100px;
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      border-radius: 50%;
    }
    #player:hover {
      filter: brightness(0.9);
    }
    #win-notification {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 64px;
      font-family: Comic Sans MS, cursive;
      color: #FFD700;
      text-shadow: 2px 2px #87CEEB;
      background-color: #6495ED;
      padding: 20px;
      border-radius: 10px;
      border: 4px solid #FFD700;
      display: none;
      z-index: 10;
    }
    #win-notification::before {
      content: "";
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      border-bottom: 20px solid #6495ED;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
    }
    #win-buttons button {
      width: 150px;
      height: 40px;
      font-size: 18px;
      font-family: Comic Sans MS, cursive;
      color: #FFFFFF;
      background-color: #FFD700;
      border: 2px solid #FFD700;
      border-radius: 5px;
      cursor: pointer;
      margin: 0 10px;
      transition: 0.2s ease-in-out;
    }
    #win-buttons button:hover {
      background-color: #FFC400;
      border: 2px solid #FFC400;
      box-shadow: 0 0 10px #FFD700;
    }
    .control-panel-container {
      position: fixed;
      bottom: 0;
      right: 0;
      padding: 20px;
      background-color: #f0f0f0;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      z-index: 1;
    }
    .control-panel {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      width: 200px;
    }
    .control-button, .blank-control {
      width: 32%;
      aspect-ratio: 1;
      margin-top: 2%;
      margin-bottom: 2%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background-color: #ccc;
      user-select: none;
    }
    .control-button:hover {
      background-color: #c0c0c0;
    }
    #welcome-iframe {
      width: 97%;
      height: 91.2vh;
      border: none;
      background-color: #ebbf64;
      padding: 20px;
      position: relative;
      z-index: 8;
      border-radius: 10px;
      border: 4px solid #FFD700;
    }
    #welcome-iframe .title {
      font-size: 64px;
      font-family: Comic Sans MS, cursive;
      color: #FFD700;
      text-shadow: 2px 2px #87CEEB;
    }
    #welcome-iframe .title::before {
      content: "";
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      border-bottom: 40px solid #6495ED;
      border-left: 40px solid transparent;
      border-right: 40px solid transparent;
    }
    #welcome-iframe .button {
      padding: 10px 20px;
      font-size: 24px;
      font-family: Comic Sans MS, cursive;
      color: #FFD700;
      background-color: #6495ED;
      border: 2px solid #FFD700;
      border-radius: 10px;
      cursor: pointer;
    }
    .menu-bar {
      background-color: #333;
      padding: 1rem;
      text-align: center;
      color: #fff;
      z-index: 5;
      position: relative;
    }
    .menu-bar ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
    }
    .menu-bar li {
      margin-right: 20px;
    }
  </style>
</head>
<body
  style="background: url('https://cdn.dribbble.com/users/4137687/screenshots/11943319/media/e373c660a94fea92668e31ff30c5ed55.gif') no-repeat center / cover;"
>
  <div class="splash-screen">
    <img src="https://mir-s3-cdn-cf.behance.net/project_modules/fs/70ea17107438539.60fdf31a103a4.gif" alt="Splash Screen GIF" />
  </div>

  <script>
    // Hide splash screen after 3 seconds
    setTimeout(() => {
      document.querySelector(".splash-screen").style.display = "none";
    }, 3000);
  </script>

  <iframe
    id="welcome-iframe"
    srcdoc="
    <html>
      <head>
        <style>
          body {
            background: url('https://img.freepik.com/premium-photo/cute-little-cartoon-rabbit-yellow-solid-background-minimalism-style_155390-2189.jpg') no-repeat right;
            background-size: contain;
            margin: 0;
            height: 100vh;
            width: 137vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
          }
          body::-webkit-scrollbar { display: none; }
          #warning-message {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #ff9900;
            padding: 10px;
            border-radius: 5px;
          }
          .title {
            font-family: Comic Sans MS, cursive;
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 20px;
            color: blue;
            text-shadow: 0px 0px 10px #FFD700, 2px 2px 5px #FFD700, -2px -2px 5px #FFD700;
          }
          .titleandbutton {
            background: #fff;
          }
          .button {
            padding: 10px 20px;
            font-size: 24px;
            cursor: pointer;
            color: blue;
            background-color: #FFD700;
            border: 2px solid #FFD700;
            border-radius: 10px;
            transition: all 0.1s ease-in-out;
          }
          .button:hover {
            background-color: blue;
            color: #FFD700;
            border: 2px solid #FFD700;
            box-shadow: 0px 0px 10px #FFD700;
          }
        </style>
      </head>
      <body>
        <div class='titleandbutton'>
          <div class='title'>
            <br />
            &nbsp;&nbsp; Welcome to BUNNY HOME! &nbsp;&nbsp;
            <br />
          </div>
          <center>
            <button class='button' onclick='startGame()'>Start Game</button>
          </center>
          <br /><br />
        </div>

        <script>
          function startGame() {
            parent.document.getElementById('welcome-iframe').remove();
          }
        </script>
      </body>
    </html>
    "
    scrolling="no"
    frameborder="0"
  ></iframe>

  <div id="game-container">
    <nav class="menu-bar">
      <ul>
        <li>BUNNY HOME</li>
      </ul>
    </nav>

    <div id="sidebar">
      <div class="circle" id="circle-1"></div>
      <div class="circle" id="circle-2"></div>
      <div class="circle" id="circle-3"></div>
    </div>

    <div id="player"></div>
    <div class="surface" style="left: 0px; top: 645px; width: 1530px; height: 10px;"></div>

    <div class="obstacle" style="left: 200px; top: 520px;"></div>
    <div class="obstacle" style="left: 400px; top: 450px;"></div>
    <div class="obstacle" style="left: 690px; top: 250px;"></div>
    <div class="obstacle" style="left: 600px; top: 380px;"></div>

    <div class="palace" style="left: 800px; top: 142px;"></div>
    <div class="door" style="left: 900px; top: 60px;"></div>

    <div id="win-notification">
      <center>You Win!</center>
      <div id="win-buttons">
        <button id="view-score-button" onclick="location.href='Bunny Home - Front Page.html'">Home</button>
        <button id="play-again-button">Play Again</button>
        <button id="exit-game-button" onclick="location.href='Bunny Home - Level 02.html'">Next Level</button>
      </div>
    </div>
  </div>

  <div class="control-panel-container">
    <div class="control-panel">
      <div class="blank-control"></div>
      <div class="control-button" id="up-control">↑</div>
      <div class="blank-control"></div>
      <div class="control-button" id="left-control">←</div>
      <div class="control-button" id="stop-control">&#x25CB;</div>
      <div class="control-button" id="right-control">→</div>
    </div>
  </div>

  <script>
    // Elements
    const player = document.getElementById("player");
    const gameContainer = document.getElementById("game-container");
    const winNotification = document.getElementById("win-notification");

    const upButton = document.getElementById("up-control");
    const leftButton = document.getElementById("left-control");
    const stopButton = document.getElementById("stop-control");
    const rightButton = document.getElementById("right-control");

    // Player state
    let playerLeft = gameContainer.offsetWidth / 2;
    let playerTop = gameContainer.offsetHeight - 60;
    let isJumping = false;
    let playerVelocityY = 0;
    const gravity = 6;
    let isOnObstacle = false;
    let currentObstacle = null;

    // Obstacles collection
    const obstacles = document.querySelectorAll(".obstacle");
    obstacles.forEach((obstacle) => {
      obstacle.speed = Math.random() * 2 + 1;
      obstacle.direction = Math.random() < 0.5 ? -1 : 1;
    });

    // Initialize player position
    player.style.left = `${playerLeft}px`;
    player.style.top = `${playerTop}px`;

    // Control buttons dispatch keyboard events
    upButton.addEventListener("click", () => {
      const event = new KeyboardEvent("keydown", { key: "ArrowUp" });
      document.dispatchEvent(event);
    });
    leftButton.addEventListener("click", () => {
      const event = new KeyboardEvent("keydown", { key: "ArrowLeft" });
      document.dispatchEvent(event);
    });
    stopButton.addEventListener("click", () => {
      // Stop movement
      playerVelocityY = 0;
      isJumping = false;
      isOnObstacle = false;
      currentObstacle = null;
    });
    rightButton.addEventListener("click", () => {
      const event = new KeyboardEvent("keydown", { key: "ArrowRight" });
      document.dispatchEvent(event);
    });

    // Keyboard controls
    document.addEventListener("keydown", (e) => {
      switch (e.key) {
        case "ArrowLeft":
          playerLeft = Math.max(0, playerLeft - 10);
          break;
        case "ArrowRight":
          playerLeft = Math.min(gameContainer.offsetWidth - player.offsetWidth, playerLeft + 10);
          break;
        case "ArrowUp":
          if (!isJumping) {
            isJumping = true;
            playerVelocityY = -25;
          }
          break;
      }
      player.style.left = `${playerLeft}px`;
    });

    // Game loop with requestAnimationFrame for smooth animation
    function gameLoop() {
      // Move obstacles
      currentObstacle = null;
      obstacles.forEach((obstacle) => {
        let obstacleLeft = parseInt(obstacle.style.left, 10) || 0;
        let delta = obstacle.speed * obstacle.direction;
        obstacleLeft += delta;

        // Bounce obstacle at boundaries
        if (obstacleLeft < 0) {
          obstacleLeft = 0;
          obstacle.direction *= -1;
        } else if (obstacleLeft > gameContainer.offsetWidth - obstacle.offsetWidth) {
          obstacleLeft = gameContainer.offsetWidth - obstacle.offsetWidth;
          obstacle.direction *= -1;
        }

        obstacle.style.left = `${obstacleLeft}px`;

        // Collision detection: Check if player is standing on this obstacle
        const obstacleRect = obstacle.getBoundingClientRect();
        const playerRect = player.getBoundingClientRect();

        // Check horizontal overlap
        const horizontalOverlap =
          playerRect.left < obstacleRect.right && playerRect.right > obstacleRect.left;

        // Check if player's feet are near obstacle's top (within 10px)
        const verticalProximity =
          Math.abs(playerRect.bottom - obstacleRect.top) < 10;

        if (horizontalOverlap && verticalProximity && playerVelocityY >= 0) {
          currentObstacle = obstacle;
        }
      });

      // Apply gravity and jumping
      if (isJumping) {
        playerTop += playerVelocityY;
        playerVelocityY += gravity;

        // Stop jumping if falling down
        if (playerVelocityY >= 0) {
          isJumping = false;
        }
      } else {
        // If not jumping and not on obstacle, fall down to ground
        if (!currentObstacle && playerTop < gameContainer.offsetHeight - player.offsetHeight) {
          playerTop += gravity;
          isOnObstacle = false;
        }
      }

      // If on obstacle, stand on it and move horizontally with it
      if (currentObstacle) {
        const obstacleLeft = parseInt(currentObstacle.style.left, 10);
        const prevPlayerLeft = playerLeft;

        // Snap player vertically on obstacle
        playerTop = currentObstacle.getBoundingClientRect().top - player.offsetHeight;

        // Move player horizontally with obstacle
        playerLeft += currentObstacle.speed * currentObstacle.direction;

        // Clamp playerLeft within game container
        playerLeft = Math.min(Math.max(0, playerLeft), gameContainer.offsetWidth - player.offsetWidth);

        isOnObstacle = true;
      } else {
        // Clamp player to ground
        if (playerTop > gameContainer.offsetHeight - player.offsetHeight) {
          playerTop = gameContainer.offsetHeight - player.offsetHeight;
        }
        isOnObstacle = false;
      }

      // Update player position styles
      player.style.top = `${playerTop}px`;
      player.style.left = `${playerLeft}px`;

      // Win condition: if player touches door
      const door = document.querySelector(".door");
      const doorRect = door.getBoundingClientRect();
      const playerRect = player.getBoundingClientRect();

      if (
        playerRect.right > doorRect.left &&
        playerRect.left < doorRect.right &&
        playerRect.bottom > doorRect.top &&
        playerRect.top < doorRect.bottom
      ) {
        winNotification.style.display = "block";
      }

      requestAnimationFrame(gameLoop);
    }

    requestAnimationFrame(gameLoop);

    // Win notification buttons
    document.getElementById("play-again-button").addEventListener("click", () => {
      winNotification.style.display = "none";
      playerLeft = gameContainer.offsetWidth / 2;
      playerTop = gameContainer.offsetHeight - player.offsetHeight;
      player.style.left = `${playerLeft}px`;
      player.style.top = `${playerTop}px`;
    });
  </script>
</body>
</html>
