<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WRight Equation - Equation Framer</title>
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #ffffff;
    color: #008000;
    display: flex;
    flex-direction: column;
    height: 100vh;
}

h1 {
    text-align: center;
    margin: 10px 0;
}

#toolbar {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    padding: 10px 20px;
}

button {
    background-color: #ffffff;
    color: #008000;
    border: 2px solid #008000;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 14px;
}

button:hover { background-color: #e6ffe6; }

#mainContainer {
    display: flex;
    flex: 1;
    gap: 10px;
    padding: 10px 20px;
}

#canvasContainer {
    flex: 3;
    border: 2px solid #008000;
    position: relative;
}

canvas {
    background-color: #ffffff;
    width: 100%;
    height: 100%;
}

#outputContainer {
    flex: 1;
    border: 2px solid #008000;
    padding: 10px;
    overflow-y: auto;
    height: 90%;
}

#bottomTaskbar {
    border-top: 2px solid #008000;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

#bottomTaskbar input {
    flex: 1;
    padding: 5px;
    border: 2px solid #008000;
    font-size: 14px;
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script>
</head>
<body>

<h1>WRight Equation <br><span style="font-size:18px;">Equation Framer</span></h1>

<div id="toolbar">
    <button onclick="selectTool('freehand')">Freehand</button>
    <button onclick="selectTool('line')">Straight Line</button>
    <button onclick="selectTool('curve')">Curved Line</button>
    <button onclick="selectTool('triangle')">Triangle</button>
    <button onclick="selectTool('eraser')">Eraser</button>
    <button onclick="selectTool('text')">Text</button>
    <button onclick="undo()">Undo</button>
    <button onclick="redo()">Redo</button>
    <button onclick="resetCanvas()">Reset</button>
    <select id="colorSelector">
        <option value="black">Black</option>
        <option value="green">Green</option>
    </select>
</div>

<div id="mainContainer">
    <div id="canvasContainer">
        <canvas id="paintCanvas" width="800" height="400"></canvas>
    </div>
    <div id="outputContainer" contenteditable="true">
        <h3>Equations</h3>
    </div>
</div>

<div id="bottomTaskbar">
    <label>Input Equation:</label>
    <input type="text" id="bottomInput" placeholder="Enter equation...">
    <button onclick="drawFromEquation()">Draw Graph</button>
</div>

<script>
// ------------------------ Canvas Setup ------------------------
const canvas = document.getElementById('paintCanvas');
const ctx = canvas.getContext('2d');
let currentTool = 'freehand';
let drawing = false;
let startX = 0;
let startY = 0;
let color = 'black';
const colorSelector = document.getElementById('colorSelector');

let elements = [];
let undoStack = [];
let redoStack = [];

// ------------------------ Tool Functions ------------------------
function selectTool(tool) {
    currentTool = tool;
}

colorSelector.addEventListener('change', () => {
    color = colorSelector.value;
});

canvas.addEventListener('mousedown', e => {
    drawing = true;
    startX = e.offsetX;
    startY = e.offsetY;
    if (currentTool === 'freehand' || currentTool === 'eraser') {
        ctx.beginPath();
        ctx.moveTo(startX, startY);
        ctx.strokeStyle = currentTool === 'eraser' ? '#ffffff' : color;
        ctx.lineWidth = currentTool === 'eraser' ? 10 : 2;
    }
});

canvas.addEventListener('mousemove', e => {
    if (!drawing) return;
    const mouseX = e.offsetX;
    const mouseY = e.offsetY;
    if (currentTool === 'freehand' || currentTool === 'eraser') {
        ctx.lineTo(mouseX, mouseY);
        ctx.stroke();
    }
});

canvas.addEventListener('mouseup', e => {
    if (!drawing) return;
    drawing = false;
    const endX = e.offsetX;
    const endY = e.offsetY;

    if (['line','curve','triangle'].includes(currentTool)) {
        const element = { type: currentTool, startX, startY, endX, endY, color, points: [], equation: '' };
        if(currentTool==='curve'){element.points.push([startX,startY],[endX,endY]);}
        elements.push(element);
        pushUndo(); // store for undo
        computeEquation(element);
        redrawCanvas();
    }
});

// ------------------------ Undo / Redo ------------------------
function pushUndo() {
    undoStack.push(JSON.stringify(elements));
    redoStack = []; // clear redo
}

function undo() {
    if(undoStack.length>0){
        redoStack.push(JSON.stringify(elements));
        elements = JSON.parse(undoStack.pop());
        redrawCanvas();
        updateOutput();
    }
}

function redo() {
    if(redoStack.length>0){
        undoStack.push(JSON.stringify(elements));
        elements = JSON.parse(redoStack.pop());
        redrawCanvas();
        updateOutput();
    }
}

function resetCanvas(){
    if(confirm("Are you sure you want to reset the canvas?")){
        elements=[];
        undoStack=[];
        redoStack=[];
        ctx.clearRect(0,0,canvas.width,canvas.height);
        updateOutput();
    }
}

// ------------------------ Drawing / Redraw ------------------------
function redrawCanvas() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    elements.forEach(el=>drawElement(el));
}

function drawElement(el){
    ctx.strokeStyle=el.color;
    ctx.beginPath();
    if(el.type==='line'){
        ctx.moveTo(el.startX, el.startY);
        ctx.lineTo(el.endX, el.endY);
        ctx.stroke();
    }else if(el.type==='curve'){
        const [p1,p2]=el.points;
        const cx=(p1[0]+p2[0])/2;
        const cy=p1[1]-100;
        ctx.moveTo(p1[0],p1[1]);
        ctx.quadraticCurveTo(cx,cy,p2[0],p2[1]);
        ctx.stroke();
    }else if(el.type==='triangle'){
        ctx.moveTo(el.startX,el.startY);
        ctx.lineTo(el.endX,el.endY);
        ctx.lineTo(el.startX,el.endY);
        ctx.closePath();
        ctx.stroke();
    }
}

// ------------------------ Equation Computation ------------------------
function computeEquation(el){
    if(el.type==='line'){
        const m = (el.endY-el.startY)/(el.endX-el.startX);
        const c = el.startY - m*el.startX;
        el.equation = `y = ${m.toFixed(2)}x + ${c.toFixed(2)}`;
    } else if(el.type==='triangle'){
        const a = Math.hypot(el.endX-el.startX, el.endY-el.startY);
        const b = Math.hypot(el.endX-el.startX, 0);
        const c = Math.hypot(el.endY-el.startY, 0);
        el.equation = `Triangle sides ≈ a:${a.toFixed(2)}, b:${b.toFixed(2)}, c:${c.toFixed(2)}`;
    } else if(el.type==='curve'){
        el.equation = `Approx curve equation (JS-fit)`;
    }
    updateOutput();
}

// ------------------------ Output ------------------------
function updateOutput(){
    const output=document.getElementById('outputContainer');
    let html='<h3>Equations</h3>';
    elements.forEach((el,i)=>{html+=`<div contenteditable="true">${i+1}: ${el.equation}</div>`;});
    output.innerHTML=html;
}

// ------------------------ Equation → Graph ------------------------
document.getElementById('bottomInput').addEventListener('keydown', e=>{
    if(e.key==='Enter'){
        drawFromEquation();
    }
});

function drawFromEquation(){
    const eq=document.getElementById('bottomInput').value.trim();
    if(eq===''){alert('Please enter an equation'); return;}
    // Validate spacing around operators
    if(/[\+\-\*\/]\s|\s[\+\-\*\/]/.test(eq)){alert('No spaces allowed between operator and operands'); return;}
    // Example: simple linear y=mx+c
    const match = eq.match(/y\s*=\s*([\-]?\d*\.?\d*)x\s*([\+\-]\s*\d*\.?\d*)?/);
    if(match){
        const m=parseFloat(match[1]);
        const c=parseFloat(match[2].replace(/\s/g,''));
        const element={type:'line',startX:0,startY:c,endX:canvas.width,endY:m*canvas.width+c,color:'green',points:[],equation:eq};
        elements.push(element);
        pushUndo();
        redrawCanvas();
        updateOutput();
    }else{
        alert('Currently only simple linear equations are supported in input');
    }
    document.getElementById('bottomInput').value='';
}
</script>
</body>
</html>
